

####################################################################
# Зажечь лампочку RD10 (chipKIT #8) по нажатию кнопки RF1 (chipKIT #4)
main:   .global main                # Помечаем метку main как глобальную

    # Установить ножку RF1 как ввод - устновить бит TRISF[1] в 1 - отправить 0x1 в регистр TRISFSET
    addi   $t1, $0, 1 << 1
    la     $t2, 0xBF886148 #TRISFSET
    sw     $t1, 0 ($t2)

    # Установить ножку RD10 как вывод - устновить бит TRISD[10] в 1 - отправить 0x400 в регистр TRISDCLR
    addi   $t1, $0, 1 << 10
    la     $t2, 0xBF8860C4 #TRISDCLR
    sw     $t1, 0 ($t2)  

loop:
    # Считать значение с ножки RF1 - получить значение бита PORTF[1]
    la     $t2, 0xBF886150 #PORTF
    lw     $t1, 0 ($t2)
    ext    $t3, $t1, 1, 1
    
    addi   $t4, $0, 1
    beq $t3, $t4, button_on

    # кнопка выключена
    # Задать значение 0 на ножке RD10 - установить бит PORTD[10] в 0 - отправить 0x400 в регистр LATDCLR
    addi   $t1, $0, 1 << 10
    la     $t2, 0xBF8860E4 #LATDCLR
    sw     $t1, 0 ($t2) 

    j loop
button_on:
    # кнопка включена
    # Задать значение 1 на ножке RD10 - установить бит PORTD[10] в 1 - отправить 0x400 в регистр LATDSET
    addi   $t1, $0, 1 << 10
    la     $t2, 0xBF8860E8 #LATDSET
    sw     $t1, 0 ($t2) 

    j loop
